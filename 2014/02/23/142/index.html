
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="baidu-site-verification" content="qig9fkyLqw" />
  <meta name="baidu_union_verify" content="d1952c66cf48912e21c18c7c581f382a">
  <meta name="360-site-verification" content="67fbcc5a67f4c65c057315b28fa0b2c8" />
<meta name="google-site-verification" content="2GzxQ0VtXwTSUdmGm6DzcmhTzM_I9QmzCb_pzpMzD88" />
  
    <title>Session的本质和入门 | 心缘冰河</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="donahue">
    
    <meta name="description" content="大多数web应用程序都离不开session的使用。这篇文章将会结合php以及http协议来分析如何建立一个安全的会话管理机制。
我们先简单的了解一些http的知识，从而理解该协议的无状态特性。然后，学习一些关于cookie的基本操作。最后，我会一步步阐述如何使用一些简单，高效的方法来提高你的php应">
    
    
    
    
    <link rel="alternate" href="/atom.xml" title="心缘冰河" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            var _bdId ='391982416296a0d54221f59fe35250d4';
             hm.src = "//hm.baidu.com/hm.js?" + _bdId;
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
        })();
    </script>
     
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="心缘冰河">心缘冰河</a></h1>
				<a class="blog-motto">写出我人生,coding</a>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					
					<li> <a title="把这个链接拖到你的Chrome收藏夹工具栏中" href='javascript:(function() {
	function c() {
		var e = document.createElement("link");
		e.setAttribute("type", "text/css");
		e.setAttribute("rel", "stylesheet");
		e.setAttribute("href", f);
		e.setAttribute("class", l);
		document.body.appendChild(e)
	}
 
	function h() {
		var e = document.getElementsByClassName(l);
		for (var t = 0; t < e.length; t++) {
			document.body.removeChild(e[t])
		}
	}
 
	function p() {
		var e = document.createElement("div");
		e.setAttribute("class", a);
		document.body.appendChild(e);
		setTimeout(function() {
			document.body.removeChild(e)
		}, 100)
	}
 
	function d(e) {
		return {
			height : e.offsetHeight,
			width : e.offsetWidth
		}
	}
 
	function v(i) {
		var s = d(i);
		return s.height > e && s.height < n && s.width > t && s.width < r
	}
 
	function m(e) {
		var t = e;
		var n = 0;
		while (!!t) {
			n += t.offsetTop;
			t = t.offsetParent
		}
		return n
	}
 
	function g() {
		var e = document.documentElement;
		if (!!window.innerWidth) {
			return window.innerHeight
		} else if (e && !isNaN(e.clientHeight)) {
			return e.clientHeight
		}
		return 0
	}
 
	function y() {
		if (window.pageYOffset) {
			return window.pageYOffset
		}
		return Math.max(document.documentElement.scrollTop, document.body.scrollTop)
	}
 
	function E(e) {
		var t = m(e);
		return t >= w && t <= b + w
	}
 
	function S() {
		var e = document.createElement("audio");
		e.setAttribute("class", l);
		e.src = i;
		e.loop = false;
		e.addEventListener("canplay", function() {
			setTimeout(function() {
				x(k)
			}, 500);
			setTimeout(function() {
				N();
				p();
				for (var e = 0; e < O.length; e++) {
					T(O[e])
				}
			}, 15500)
		}, true);
		e.addEventListener("ended", function() {
			N();
			h()
		}, true);
		e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
		document.body.appendChild(e);
		e.play()
	}
 
	function x(e) {
		e.className += " " + s + " " + o
	}
 
	function T(e) {
		e.className += " " + s + " " + u[Math.floor(Math.random() * u.length)]
	}
 
	function N() {
		var e = document.getElementsByClassName(s);
		var t = new RegExp("\\b" + s + "\\b");
		for (var n = 0; n < e.length; ) {
			e[n].className = e[n].className.replace(t, "")
		}
	}
 
	var e = 30;
	var t = 30;
	var n = 350;
	var r = 350;
	var i = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake.mp3";
	var s = "mw-harlem_shake_me";
	var o = "im_first";
	var u = ["im_drunk", "im_baked", "im_trippin", "im_blown"];
	var a = "mw-strobe_light";
	var f = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css";
	var l = "mw_added_css";
	var b = g();
	var w = y();
	var C = document.getElementsByTagName("*");
	var k = null;
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			if (E(A)) {
				k = A;
				break
			}
		}
	}
	if (A === null) {
		console.warn("Could not find a node of the right size. Please try a different page.");
		return
	}
	c();
	S();
	var O = [];
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			O.push(A)
		}
	}
})()    '>High一下</a> </li>
					<li>
					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" autocomplete="off" name="q" maxlength="20" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
                            </nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/02/23/142/" title="Session的本质和入门" itemprop="url">Session的本质和入门</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://donahue-ldz.github.io" title="donahue">donahue</a>
    </p>
  <p class="article-time">
    <time datetime="2014-02-23T14:37:40.000Z" itemprop="datePublished">Feb 23 2014</time>
    更新日期:<time datetime="2015-03-07T04:42:44.000Z" itemprop="dateModified">Mar 7 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#无状态性"><span class="toc-number">1.</span> <span class="toc-text">无状态性</span></a></li></ol>
		</div>
		
		<p><strong>大多数web应用程序都离不开session的使用。这篇文章将会结合php以及http协议来分析如何建立一个安全的会话管理机制。</strong></p>
<p>我们先简单的了解一些http的知识，从而理解该协议的无状态特性。然后，学习一些关于cookie的基本操作。最后，我会一步步阐述如何使用一些简单，高效的方法来提高你的php应用程序的安全性以及稳定行，这就是本文的写作思路</p>
<h2 id="无状态性">无状态性</h2><p><strong>Http是一种无状态性的协议。这是因为此种协议不要求浏览器在每次请求中标明它自己的身份，并且浏览器以及服务器之间并没有保持一个持久性的连接用于多个页面之间的访问。</strong>当一个用户访问一个站点的时候，用户的浏览器发送一个http请求到服务器，服务器返回给浏览器一个http响应。其实很简单的一个概念，客户端一个请求，服务器端一个回复，这就是整个基于http协议的通讯过程。</p>
<p>因为web应用程序是基于http协议进行通讯的，而我们已经讲过了http是无状态的，这就增加了维护web应用程序状态的难度, 对于开发者来说，是一个不小的挑战。<strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookies</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>是作为</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的一个扩展诞生的，其主要用途是弥补</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的无状态特性，提供了一种保持客户端与服务器端之间状态的途径，但是由于出于安全性的考虑，有的用户在浏览器中是禁止掉</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的。这种情况下，状态信息只能通过</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中的参数来传递到服务器端，不过这种方式的安全性很差</span></span></span></strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。事实上，按照通常的想法，应该有客户端来表明自己的身份，从而和服务器之间维持一种状态，但是出于安全性方面的考虑，我们都应该明白一点 – 来自客户端的信息都是不能完全信任的。</span></span></span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">尽管这样，针对维持</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>web</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>应用程序状态的问题，相对来说，还是有比较优雅的解决方案的。不过，应该说是没有完美的解决方案的，再好的解决方案也不可能适用所有的情况。</span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">这篇文章将介绍一些技术。这些技术可以用来比较稳定地维持应用程序的状态以及抵御一些针对</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">session</span></span><span style="font-family: 'DejaVu Sans';"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">的攻击，比如会话劫持。并且你可以学习到</span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">cookie</span></span><span style="font-family: 'DejaVu Sans';"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">是怎样工作的，</span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">php </span></span><span style="font-family: 'DejaVu Sans';"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">的</span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">session</span></span><span style="font-family: 'DejaVu Sans';"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">做了那些事情，以及怎样才能劫持</span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">session</span></span><span style="font-family: 'DejaVu Sans';"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">。</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>HTTP </span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>概览</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>如何才能保持</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>web</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>应用程序的状态以及选择最合适的解决方案呢</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>?</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在回答这个问题之前，必须得先了解</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>web</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的底层协议 – </span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Hypertext Transfer Protocol (HTTP)</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>当用户访问</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><a href="http://example.com" target="_blank" rel="external">http://example.com</a></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这个域名的时候，浏览器就会自动和服务器建立</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>tcp/ip</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>连接，然后发送</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>请求到</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>example.com</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的服务器的</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>80</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>端口。该个请求的语法如下所示：</span></span></span></strong></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET / HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以上第一行叫做请求行，第二个参数</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>(</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>一个反斜线在这个例子中</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>)</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>表示所请求资源的路径。反斜线代表了根目录</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>;</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>服务器会转换这个根目录为服务器文件系统中的一个具体目录。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Apache</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的用户常用</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>DocumentRoot</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这个命令来设置这个文档根路径。如果请求的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>是</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><a href="http://example.org/path/to/script.php" target="_blank" rel="external">http://example.org/path/to/script.php</a>,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>那么请求的路径就是</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>/path/to/script.php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。假如</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>document root </span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>被定义为</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>usr/lcoal/apache/htdocs</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的话</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>整个请求的资源路径就是</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>/usr/local/apache/htdocs/path/to/script.php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>第二行描述的是</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部的语法。在这个例子中的头部是</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host, </span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>它标识了浏览器希望获取资源的域名主机。还有很多其它的请求头部可以包含在</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>请求中，比如</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>user-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部，在</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>可以通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_SERVER[‘HTTP_USER_AGENT’]</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>获取请求中所携带的这个头部信息。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>但是遗憾的是，在这个请求例子中，没有任何信息可以唯一标识当前这个发出请求的客户端。有些开发者借助请求中的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部来唯一标识发出此次请求的客户端，但是这种方式存在很多问题。因为，有些用户是通过代理来访问的，比如用户</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>A</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>通过代理</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>B</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>连接网站</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>www.example.com, </span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>服务器端获取的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>信息是代理</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>B</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>分配给</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>A</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>地址，如果用户这时断开代理，然后再次连接代理的话，它的代理</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>地址又再次改变，也就说一个用户对应了多个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>地址，这种情况下，服务器端根据</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>地址来标识用户的话，会认为请求是来自不同的用户，事实上是同一个用户。 还用另外一种情况就是，比如很多用户是在同一个局域网里通过路由连接互联网，然后都访问</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>www.example.com</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的话，由于这些用户共享同一个外网</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>地址，这会导致服务器认为这些用户是同一个用户发出的请求，因为他们是来自同一个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>ip</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>地址的访问。</span></span></span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>保持应用程序状态的第一步就是要知道如何来唯一地标识每个客户端。因为只有在</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中请求中携带的信息才能用来标识客户端，所以在请求中必须包含某种可以用来标识客户端唯一身份的信息。</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>设计出来就是用来解决这一问题的。</span></span></span></strong></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookies</span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">如果你把</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookies</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">看成为</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">协议的一个扩展的话，理解起来就容易的多了，其实本质上</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookies</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">就是</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的一个扩展。</span></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>有两个</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部是专门负责设置以及发送</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>,</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>它们分别是</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Set-Cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以及</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">。当服务器返回给客户端一个</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">响应信息时，其中如果包含</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Set-Cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">这个头部时，意思就是指示客户端建立一个</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">，并且在后续的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">请求中自动发送这个</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">到服务器端，直到这个</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>过期。</span></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>如果</span></span></span></strong></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的生存时间是整个会话期间的话，那么浏览器会将</span></span></span></strong></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>保存在内存中，浏览器关闭时就会自动清除这个</span></span></span></strong></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>另外一种情况就是保存在客户端的硬盘中，浏览器关闭的话，该</span></span></span></strong></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>也不会被清除，下次打开浏览器访问对应网站时，这个</span></span></span></strong></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>就会自动再次发送到服务器端。一个</span></span></span></strong></span></span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的设置以及发送过程分为以下四步：</span></span></span></strong></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>客户端发送一个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>请求到服务器端</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>服务器端发送一个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>响应到客户端，其中包含</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Set-Cookie</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>客户端发送一个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>请求到服务器端，其中包含</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>服务器端发送一个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>响应到客户端</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这个通讯过程也可以用以下下示意图来描述：</span></span></span></p>
<p><a href="http://www.donahueblogs.com/wp-content/uploads/2014/02/wKioL1L4ODyRKtgIAAApxsnaeTs011.png" target="_blank" rel="external"><img src="http://www.donahueblogs.com/wp-content/uploads/2014/02/wKioL1L4ODyRKtgIAAApxsnaeTs011-300x150.png" alt="wKioL1L4ODyRKtgIAAApxsnaeTs011"></a></p>
<p>&nbsp;</p>
<p><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">在客户端的第二次请求中包含的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">头部中，提供给了服务器端可以用来唯一标识客户端身份的信息。这时，服务器端也就可以判断客户端是否启用了</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookies</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>尽管，用户可能在和应用程序交互的过程中突然禁用</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookies</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的使用，但是，这个情况基本是不太可能发生的，所以可以不加以考虑，这在实践中也被证明是对的</span></span></span></strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET and POST Data</span></span></span></p>
<p><strong>除了cookies,客户端还可以将发送给服务器的数据包含在请求的url中，比如请求的参数或者请求的路径中。 我们来看一个例子：</strong></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET /index.php?foo=bar HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">以上就是一个常规的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http get </span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">请求，该</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>get</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">请求发送到</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>example.org</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">域名对应的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>web </span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">服务器下的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>index.php</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">脚本</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>, </span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">在</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>index.php</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">脚本中，可以通过</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_GET[‘foo’]</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">来获取对应的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">中</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>foo</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">参数的值，也就是’</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>bar’</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>大多数</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">php</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>开发者都称这样的数据会</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">GET</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据，也有少数称它为查询数据或者</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">url</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>变量</span></span></span></span></strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>但是大家需要注意一点，不是说</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据就只能包含在</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>HTTP GET</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>类型的请求中，在</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>HTTP POST</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>类型的请求中同样可以包含</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据，只要将相关</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据包含在请求的</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中即可，也就是说</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据的传递不依赖与具体请求的类型。</span></span></span></strong></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">另外一种客户端传递数据到服务器端的方式是将数据包含在</span></span></span></span></span><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">http</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">请求的内容区域内。 这种方式需要请求的类型是</span></span></span></span></span><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">POST</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: large;">的</span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>，看下面一个例子：</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>POST /index.php HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="color: #ff0000;"><span style="text-decoration: underline;">Content-Type: </span></span>application/x-www-form-urlencoded</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Content-Length: 7</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>foo=bar</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在这种情况下，在脚本</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>index.php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>可以通过调用</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_POST[‘foo’]</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>来获取对应的值</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>bar</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。开发者称这个数据为</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>POST</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>也就是大家熟知的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>form</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>post</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>方式提交请求的方式。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在一个请求中，可以同时包含这两种形式的数据：</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>POST /index.php?myget=foo HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.orgContent-Type: application/x-www-form-urlencoded</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Content-Length: 11</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>mypost=bar</span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">这两种传递数据的方式，比起用</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookies</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">来传递数据更稳定，因为</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">可能被禁用，但是以</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">以及</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>POST</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>方式传递数据时，不存在这种情况。</span></span></span><strong><span style="color: #ffff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>我们可以将</span></span></span></strong></span></span><strong><span style="color: #ffff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>PHPSESSID</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ffff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>包含在</span></span></span></strong></span></span><strong><span style="color: #ffff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>http</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ffff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>请求的</span></span></span></strong></span></span><strong><span style="color: #ffff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ffff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中</span></span></span></strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>，就像下面的例子一样：</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET /index.php?PHPSESSID=12345 HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以这种方式传递</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">session id</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的话，可以跟用</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">cookie</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部传递</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">session id</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>一样，达到同样的效果， 但是，缺点就是需要开发者认为地将</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">session id</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>附加在</span></span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><span style="text-decoration: underline;">url</span></span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="text-decoration: underline;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中或者作为隐藏字段加入到表单中。</span></span></span></span></strong><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>不像</span></span></span></span></span><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">一样，只要服务器端指示客户端创建</span></span></span></span><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">成功以后，客户端在后续的请求中，会自动第将对应的没有过期的</span></span></span></span><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #0000ff;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>传递给服务器端。</span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>当然，</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">在开启</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session.use_trans_sid</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">后，也可以自动地将</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id </span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">附加在</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">中以及表单的隐藏字段中，但是这个选项不建议开启，因为存在安全问题。这样的话，容易泄露</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id, </span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">比如有的用户会</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>bookmark</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">一个</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">或者分享一个</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">，那么</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">也就暴露了，加入这个</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">还没有过期，那是有一定的安全问题存在的，除非服务器端，除了</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">外，还附加了其它方式进行验证用户的合法性</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>!</span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>尽管以</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>POST</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的方式来传递</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的话，相对</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的方式来说，会安全的多。但是，这种方式的缺点就是比较麻烦，因为这样的话，在你的应用程序中比较将所有的请求都转换成</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>post</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的请求，这显然是不太合适的。</span></span></span></strong></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: x-large;">Session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: x-large;">的管理</span></span></span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>直到现在，我只讨论了如何维护应用程序的状态，只是简单地涉及到了如果保持请求之间的关系。接下来，我阐述下在</span></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>实际中用到比较多的技术 – </span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Session</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的管理</span></span></span></strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。</span></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>涉及到</span></span></span></strong></span></span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #ff0000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的管理，就不是单单地维持各个请求之间的状态，还需要维持会话期间针对每个特定用户使用到的数据</span></span></span></strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。我们常常把这种数据叫做</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">数据，因为这些数据是跟某个特定用户与服务器之间的会话相关联的。如果你使用</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">内置的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">的管理机制，那么</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">数据一般是保存在</span></span></span></span><span style="color: #00ff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>/tmp</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这个服务器端的文件夹中，</span></span></span><span style="color: #00ff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>并且其中的</span></span></span></span></span><span style="color: #00ff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #00ff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">数据会被自动地保存到超级数组</span></span></span></span><span style="color: #00ff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_SESSION</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #00ff00;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中。</span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>一个最简单的使用</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">的例子，就是将相关的</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">数据从一个页面传递</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>(</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">注意：实际传递的是</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id)</span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">到另一个页面。下面用示例代码</span></span></span></span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>1, start.php, </span></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;">对这个例子加以演示：</span></span></span></span></p>
<ol>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>&lt;?php</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session_start();</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_SESSION[‘foo’] = ’bar’;</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>?&gt;</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>&lt;a href=”continue.php”&gt;continue.php&lt;/a&gt;</span></span></span><br><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>假如用户点击</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>start.php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中的链接访问</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>continue.php,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>那么在</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>continue.php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中就可以通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_SESSION[‘foo’]</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>获取在</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>start.php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中的定义的值’</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>bar’</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。看下面的示例代码</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>2:</span></span></span></li>
</ol>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>示例代码</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>2 – continue.php</span></span></span></p>
<ol>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>&lt;?php</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session_start();</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>echo $_SESSION[‘foo’]; /<em> bar </em>/</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>?&gt;</span></span></span><br><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>是不是非常简单，但是我要指出的话，如果你真的这样来写代码的话，说明你对</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>底层的对于</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的实现机制还不是非常了解透彻。在不了解</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>内部给你自动做了多少事情的情况下，你会发现如果程序出错的话，这样的代码将变的很难调试，事实上，这样的代码也完全没有安全性可言。</span></span></span></span></span></li>
</ol>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: x-large;">Session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span style="font-size: x-large;">的安全性问题</span></span></span></span></span></p>
<p><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>一直以来很多开发者都认为</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>内置的</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>管理机制是具有一定的安全性，可以对一般的</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>攻击起到防御。事实上，这是一种误解，</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>团队只实现了一种方便有效的机制</span></span></span></strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。具体的安全措施，应该有应用程序的开发团队来实施。 就像开篇谈到的，没有最好的解决方案，只有最合适你的方案。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>现在，我们来看下一个比较常规的针对</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的攻击：</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>用户访问</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><a href="http://www.example.org" target="_blank" rel="external">http://www.example.org</a></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>，并且登录。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>example.org</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的服务器设置指示客户端设置相关</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie – PHPSESSID=12345</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>攻击者这时访问</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span><a href="http://www.example.org/" target="_blank" rel="external">http://www.example.org/</a>,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>并且在请求中携带了对应的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie – PHPSESSID=12345</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这样情况下，因为</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>example.orge</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的服务器通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>PHPSESSID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>来辨认对应的用户的，所以服务器错把攻击者当成了合法的用户。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>整个过程的描述，请看下面的示例图：</span></span></span></p>
<p><a href="http://www.donahueblogs.com/wp-content/uploads/2014/02/wKiom1L4OH2S5JwHAAA5g2I22fE912.png" target="_blank" rel="external"><img src="http://www.donahueblogs.com/wp-content/uploads/2014/02/wKiom1L4OH2S5JwHAAA5g2I22fE912-300x150.png" alt="wKiom1L4OH2S5JwHAAA5g2I22fE912"></a></p>
<p>&nbsp;</p>
<p><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>当然这种攻击的方式，前提条件是攻击者必须通过某种手段固定，劫持或者猜测出某个合法用户的</span></span></span></strong></span></span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>PHPSESSID</span></span></span></strong><span style="font-family: 'DejaVu Sans';"><span><strong><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。虽然这看起来难度很高，但是也不是不可能的事情。</span></span></span></strong></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>安全性的加强</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>有很多技术可以用来加强</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的安全性，主要思想就是要使验证的过程对于合法用户来说，越简单越好，然后对于攻击者来说，步骤要越复杂越好。当然，这似乎是比较难于平衡的，要根据你应用程序的具体设计来做决策。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>最简单的居于</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>HTTP/1.1</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>请求包括请求行以及一些</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的头部：</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET / HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>如果客户端通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>PHPSESSID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>传递相关的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>标识符，可以将</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>PHPSESSID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>放在</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部中进行传递</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>:</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET / HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie: PHPSESSID=12345</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>同样地，客户端也可以将</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>标识符放在请求的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>url</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中进行传递。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET /?PHPSESSID=12345</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>HTTP/1.1Host: example.org</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>当然，</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>标识符也可以包含在</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>POST</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据中，但是这对用户体验有影响，所以这种方式很少采用。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>因为来自</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>TCP/IP</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>信息也不一定可以完全信任的，所以，对于</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>web</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>开发者来说，利用</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>TCP/IP</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中的信息来加强安全性也是不太合适的。 不过，攻击者也必须提供一个合法用户的唯一的标识符，才能假扮成合法用户进入系统。因此，看起来唯一能够有效的保护系统的措施，就是尽量地隐藏</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>标识符或者使之难于猜测出来。最好就是两者都能实施。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>PHP</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>会自动生成一个随机的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>，基本来说是不可能被猜测出来的，所以这方面的安全还是有一定保障的。但是，要防止攻击者获取一个合法的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>是相当困难的，这基本上不是开发者所能控制的。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>事实上，许多情况下都有可能导致</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的泄露。 比如说，如果通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据来传递</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的话，就有可能暴露这个敏感的身份信息。因为，有的用户可能会将带有</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的链接缓存，收藏或者发送在邮件内容中。</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookies</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>是一种像相对来说安全一点的机制，但是用户是可以在客户端中禁止掉</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookies</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>!</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在一些</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>IE</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的版本中也有比较严重的安全漏洞，比较有名的就是会泄露</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookies</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>给一些有安全隐患的邪恶站点。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>因此，作为一个开发者，可以肯定</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>是不能被猜测出来的，但是还是有可能被攻击者使用某些方法获取到。所以，必须采取一些额外的安全措施来防止此类情况在你的应用程序中发生。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>实际上，一个标准的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>HTTP</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>请求中除了</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>等必须包含的头部，还包含了一些可选的头部</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>.</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>举一个例子，看下面的一个请求：</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET / HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie: PHPSESSID=12345</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Accept: text/html;q=0.9, <em>/</em>;q=0.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Accept-Charset: ISO-8859-1, utf-8;q=0.66, *;q=0.66</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Accept-Language: en</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>我们可以看到，在以上的一个请求例子中包含了四个额外的头部，分别是</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent, Accept, Accept-Charset</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以及</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Accept-Language</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。因为这些头部不是必须的，所以完全依赖他们在你的应用程序中发挥作用是不太明智的。但是，如果一个用户的浏览器确实发送了这些头部到服务器，那么可以肯定的是在接下来的同一个用户通过同一个浏览器发送的请求中，必然也会携带这些头部。当然，这其中也会有极少数的特殊情况发生。假如以上例子是由一个当前的跟服务器建立了会话的用户发出的请求，考虑下面的一个请求：</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET / HTTP/1.1</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Host: example.org</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie: PHPSESSID=12345</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent: Mozilla/5.0</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>因为有相同的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>包含在请求的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Cookie</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部中，所以相同的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>php session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>将会被访问到。但是，请求里的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部跟先前的请求中的信息是不同的，系统是否可以假定这两个请求是同一个用户发出的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>?</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>像这种情况下，发现浏览器的头部改变了，但是不能肯定这是否是一次来自攻击者的请求的话，比较好的措施就是弹出一个要求输入密码的输入框让用户输入，这样的话，对用户体验的影响不会很大，又能很有效地防止攻击。</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>当然，你可以在系统中加入核查</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部的代码，类似示例</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>3</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中的代码：</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>示例代码</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>3</span></span></span></p>
<ol>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>&lt;?php</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session_start();</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>if (md5($_SERVER[‘HTTP_USER_AGENT’]) != $_SESSION[‘HTTP_USER_AGENT’])</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>{&amp;nbsp;&amp;nbsp;/<em> </em></span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>弹出密码输入框 </span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>/&amp;nbsp;&amp;nbsp;exit;</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>}</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>?&gt;</span></span></span><br><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>当然，你先必须在第一次请求时，初始化</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的时候，用</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>MD5</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>算法加密</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>user agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>信息并且保存在</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中，类似下面示例</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>4</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>中的代码：</span></span></span></span></span></li>
</ol>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>示例代码</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>4</span></span></span></p>
<ol>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>&lt;?php</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session_start();</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_SESSION[‘HTTP_USER_AGENT’] = md5($_SERVER[‘HTTP_USER_AGENT’]);</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>?&gt;</span></span></span><br><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>虽然不一定需要用</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>MD5</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>来加密这个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>信息，但使用这种方式以后就不需要再过滤这个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_SERVER[‘HTTP_USER_AGENT’]</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据了。不然的话，在使用这个数据以前必须要进行数据过滤，因为任何来自客户端的数据都是不可信任的，必须要注意这一点。</span></span></span></span></span></li>
</ol>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在你检查这个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>客户端头部信息以后，做为一个攻击者必须要完成两步才能劫持一个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session:</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>获取一个合法的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>包含一个相同的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部在伪造的请求中</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>你可能会说，居然攻击者能获得有效的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>那么以他的水平，伪造一个相同的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>不是件难事。不错，但是我们可以说这至少给他添加了一些麻烦，在一定程度上也增加了</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>机制的安全性。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>你应该也能想到了，既然我们可以检查</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这个头部来加强安全性，那么不妨再利用其它的一些头部信息，把他们组合起来生成一个加密的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>，并且让客户端在后续的请求中携带这个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token!</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这样的话，攻击者基本上不可能猜测出这样一个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>是怎么生成出来的。这好比你用信用卡在超市付款，一个你必须有信用卡</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>(</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>好比</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id)</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>，另外你也必须输入一个支付密码</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>(</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>好比</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token),</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这有这两者都符合的情况下，你才能成功进入账号付款。 看下面一段代码：</span></span></span></span></span></p>
<ol>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>&lt;?php</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session_start();</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$token = ’SHIFLETT’ . $_SERVER[‘HTTP_USER_AGENT’];</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>$_SESSION[‘token’] = md5($token . session_id());</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>?&gt;</span></span></span></li>
<li><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>注意：</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>Accept</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这个头部不应该被用来生成</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>因为有些浏览器会自动改变这个头部，当用户刷新浏览器的时候。</span></span></span></span></span><br><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在你的验证机制中加入了这个非常难于猜测出来的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以后，安全性会得到很大的提升。假如这个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>通过像</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>一样的方式来进行传递，这种情况下，一个攻击者必须完成必要的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>3</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>步来劫持用户的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session:</span></span></span></li>
</ol>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>获取一个合法的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在请求中加入相同的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>User-Agent</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>头部</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>用与生成</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>在请求中携带被攻击者的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>这里面有个问题。如果</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以及</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>都是通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据来传递的话，那么对于能获取</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session ID</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的攻击者，同样就能够获取到这个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。所以，比较安全靠谱的方式应该是利用两种不同的数据传递方式来分别传递</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>以及</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。例如，通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>cookie</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>来传递</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session id,</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>然后通过</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>GET</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>数据来传递</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>。因此，假如攻击者通过某种手段获得了这个唯一的用户身份标识，也是不太可能同时轻松地获取到这个</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>token</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>，它相对来说依然是安全的。</span></span></span></span></span></p>
<p><span style="color: #000000;"><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>还有很多的技术手段可以用来加强你的</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>机制的安全性。希望你在大致了解</span></span></span></span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>session</span></span><span style="font-family: 'DejaVu Sans';"><span><span style="font-family: Helvetica, Arial, 'Droid Sans', sans-serif;"><span>的内部本质以后，可以设计出适合你的应用系统的验证机制，从而大大的提高系统的安全性。毕竟，你是最熟悉当下你开发的系统的开发者之一，可以根据实际情况来实施一些特有的，额外的安全措施。</span></span></span></span></span></p>
<p>&nbsp;</p>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://donahue-ldz.github.io/2014/02/23/142/" data-title="Session的本质和入门 | 心缘冰河" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/02/25/linux-e4-b8-8b-e5-ae-89-e8-a3-85mysql/" title="linux下安装mysql和配置">
  <strong>PREVIOUS:</strong><br/>
  <span>
  linux下安装mysql和配置</span>
</a>
</div>


<div class="next">
<a href="/2014/02/23/e6-8c-87-e9-92-88-e6-97-b6-e7-9a-84-e9-99-b7-e9-98-b1/"  title="指针“陷阱” ">
 <strong>NEXT:</strong><br/> 
 <span>指针“陷阱” 
</span>
</a>
</div>

</nav>

	
<section class="comment">
	
	<div class="ds-thread" data-title="Session的本质和入门" data-thread-key="142" data-author-key="donahue" data-url="http://donahue-ldz.github.io/post/142"></div>
	
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#无状态性"><span class="toc-number">1.</span> <span class="toc-text">无状态性</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-logo"></div>		
	
	<div class="social-list" class="clearfix">
		
		
		
		
		
	</div>
</div>

  <div class="widget intro">
<h3 class="asidetitle">简介</h3>
<ul class="entry">
<li>现状：大连理工大学/本科生</li>
<li>QQ 号：635884063</li>
<li>github :  <a href="https://github.com/donahue-ldz">donahue-ldz</a></li>
</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/java/" title="java">java<sup>4</sup></a></li>
		
			<li><a href="/categories/未分类/" title="未分类">未分类<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
      <li><a href="http://gengbiao.me" target="_blank" title="coney">coney's Blog</a></li>
    </ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/CyclicBarrier/" style="font-size: NaNpx;">CyclicBarrier</a><a href="/tags/MarkDown/" style="font-size: NaNpx;">MarkDown</a><a href="/tags/finalize/" style="font-size: NaNpx;">finalize</a><a href="/tags/log4j/" style="font-size: NaNpx;">log4j</a><a href="/tags/log4j配置/" style="font-size: NaNpx;">log4j配置</a><a href="/tags/内存回收/" style="font-size: NaNpx;">内存回收</a><a href="/tags/日志记录/" style="font-size: NaNpx;">日志记录</a><a href="/tags/线程/" style="font-size: NaNpx;">线程</a><a href="/tags/线程等待，CountDownLatch/" style="font-size: NaNpx;">线程等待，CountDownLatch</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
    
            <p class="copyright"> © 2015 
		
		<a href="http://donahue-ldz.github.io" target="_blank" title="donahue">donahue</a>
		
            && Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> && Theme by <a href="http://gengbiao.me" target="_blank" title="coney">coney</a>
            </div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 






<script>
    
        var _bdImg = '4';
    
    window._bd_share_config={
        "common":{
            "bdSnsKey":{

            },
            "bdText":"",
            "bdMini":"2",
            "bdMiniList":[
                "qzone",
                "tsina",
                "weixin",
                "renren",
                "tqq",
                "tieba",
                "douban",
                "sqq",
                "diandian",
                "huaban",
                "youdao",
                "mail",
                "ty",
                "fbook",
                "twi",
                "linkedin",
                "copy",
                "print"
            ],
            "bdPic":"",
            "bdStyle":"0",
            "bdSize":"16"
        },
        "slide":{
            "type":"slide",
            "bdImg":_bdImg,
            "bdPos":"right",
            "bdTop":"350"
        },
        "image":{
            "viewList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ],
            "viewText":"分享：",
            "viewSize":"16"
        },
        "selectShare":{
            "bdContainerClass":null,
            "bdSelectMiniList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ]
        }
    };
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>




<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>


  </body>
</html>

